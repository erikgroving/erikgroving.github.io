<!DOCTYPE html>
<html>	
<!--
	DDDDD	K    K
	D   DD	K  K
	D    D	KK
	D	 D	KK
	D	DD  K  K
	DDDDD   K    K


-->
<head>
	<title>Exploring the world</title>
	<meta charset="utf-8"> 
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
	<script>
		// Default initializations
		var lang = "eng";
		var quiz_idx = 0;
		var prev_idx = 0;
		var num_correct_clear = 3;
		var f;
		var clear_words = true;
		var contents;
		var vocab = [];
		var card_stack = [];
		var total_correct = 0;
		var total_wrong = 0;
		$(function() {

			// Event bindings
			$('.lang-btn').on('click', function () {
				lang = $(this).attr('id');
				console.log('langs loaded');
				//Perform GET request to change the language				
				get_data = '/?lang=' + lang;
				$.ajax ({
					type: 'GET',
					url: url
				});
			});
			
			
			// Home button clicks
			$('.main-btn').on('click', function() {
				console.log(this.id);
				displaySection(this.id);
			});
			
			var r = new FileReader();
			
			r.onload = function (e) {
				contents = e.target.result;
				var line_split = / *\r?\n/;
				var lines = contents.split(line_split);

				vocab = [];
				for (var i = 0; i < lines.length; i++) {
					var wsp_split = / *\t+ *|  +/;
					var l_r_vocab = lines[i].split(wsp_split);
					if (l_r_vocab.length != 2) {
						console.log(l_r_vocab);
						console.log('Error with input file. Please use 2 columns, separated  by a tab.');
						return;
					}
					vocab.push({
						word: l_r_vocab[0],
						word2: l_r_vocab[1],
						correct: 0
					});
				}
				refreshCardStack();
			}			

			$('#vocab_file').on('change', function(evt) {
				f = evt.target.files[0];
				if (f) {
					r.readAsText(f);
				}
			});
			
			$('#switch').on('click', function() {
				for (var i = 0; i < vocab.length; i++) {
					var tmp = vocab[i].word;
					vocab[i].word = vocab[i].word2;
					vocab[i].word2 = tmp;
				}
				prev_quiz_idx = -1;
				newWord();
			});
			
			$('#start_stop').on('click', function() {
				var status = $('#start_stop').html() == 'Start' ? true : false;
				if (status) {
					if (vocab.length) {
						newWord();
						$('#start_stop').html('Stop');
					}
					else {
						if (f) {
							r.readAsText(f);
							$('#start_stop').html('Stop');
							setTimeout(newWord(), 2000);
						}
						else {
							$('#correct').html('No file loaded. Load a file to begin');
							$('#correct').css('color', 'red');
						}
					}
				}
				else {
					$('#vocab_word').html('');
					$('#correct').html('');
					$('#start_stop').html('Start');
				}
			});
			
			$('#remove_word, #remove_curr_word').on('click', function() {
				var idx = this.id == 'remove_word' ? prev_quiz_idx : quiz_idx;
				if (idx == -1 || !vocab.length) {
					return;
				}
				else {
					$('#correct').html(vocab[idx].word + ' was removed.');
					$('#correct').css('color', 'blue');

					vocab.splice(idx, 1);
					if (prev_quiz_idx < quiz_idx && idx == prev_quiz_idx) {
						quiz_idx -= 1;
					}
					if (!vocab.length) {
						$('#start_stop').html('Start');
						$('#correct').html('That was the last word! No more words left!');
						$('#correct').css('color', 'blue');
						$('#vocab_word').html('');
					}
					if (idx == quiz_idx && vocab.length) {
						newWord();
					}
				}
			});
			
			$('#vocab_answer').on('keypress', function(e) {
				if (e.keyCode == 13) {
					if (!vocab.length) {
						return;
					}
					if ($(this).val().toUpperCase() == vocab[quiz_idx].word2.toUpperCase()) {
						$('#correct').html('Correct!');
						$('#correct').css('color', 'green');
						vocab[quiz_idx].correct += 1;
						if (vocab[quiz_idx].correct >= num_correct_clear && clear_words) {
							vocab.splice(quiz_idx, 1);
						}
						
						total_correct += 1;
						$('#num_correct').html(total_correct);
					}
					else {
						$('#correct').html('Sorry ' + vocab[quiz_idx].word + ' is ' + vocab[quiz_idx].word2);
						$('#correct').css('color', 'red');
						vocab[quiz_idx].correct = 0;
						
						total_wrong += 1;
						$('#num_incorrect').html(total_wrong);

					}
					$('#vocab_answer').val('');
					if (vocab.length > 0) {
						newWord();
					}
					else {
						$('#start_stop').html('Start');
						$('#correct').html('No more words left!');
						$('#correct').css('color', 'blue');
						$('#vocab_word').html('');
					}
				}				
			});
			
			$('#auto-removal').on('click', function() {
				clear_words = $(this).is(':checked') ? true : false;
			});
			
			$('#cons-correct').on('keypress', function(e) {
				if (e.keyCode == 13) {
					$(this).blur();
				}
			})
			.on('blur', function() {
				num_correct_clear = parseInt($(this).val());
				console.log(num_correct_clear);			
			})
			
		});

		function refreshCardStack() {
		
		}
		
		function newWord() {
			prev_quiz_idx = quiz_idx;
			while (quiz_idx == prev_quiz_idx && vocab.length > 1) {
				quiz_idx = Math.floor(Math.random() * vocab.length);
			}
			if (quiz_idx >= vocab.length) {
				return;
			}
			$('#vocab_word').html(vocab[quiz_idx].word);		
		}
		
		
		function getParameterByName(name) {
			var match = RegExp('[?&]' + name + '=([^&]*)').exec(window.location.search);
			return match && decodeURIComponent(match[1].replace(/\+/g, ' '));
		}
	</script>
</head>
<body class="body">	
	<h2>Vocab Trainer</h2>
	<div id="load_field">
		<input id="vocab_file" type="file">
	</div>
	<div id="testing_field">
		<p id="vocab_word"></p>
		<label for="vocab_answer"style="color: blue; display: block;">Enter answer: <input type="text" id="vocab_answer"></label>
		<p id="correct"></p>
		<button class="vocab-button" id="start_stop">Start</button>
		<button class="vocab-button" id="switch">Switch</button>
		<button class="vocab-button" id="remove_curr_word">Remove current word</button>
		<button class="vocab-button" id="remove_word">Remove previous word</button>
		<div style="display: block; margin-top: 20px; margin-bottom: 20px;">
			<input type="checkbox" checked="true" id="auto-removal" style="margin-right: 10px; height: 20px; width: 20px;"><span style="color: blue;">Automatically remove word after <input type="number" value=3 id="cons-correct"> consecutive correct answers</span>
		</div>
		<div class="col-md-6" style="text-align: center;">Correct: <span style="color: green;" id="num_correct">0</span></div>
		<div class="col-md-6" style="text-align: center;">Incorrect: <span id="num_incorrect" style="color: red;">0</span></div>
	</div>
	
	<div id="vocab_read_me" style="text-align: left;">
		<br><br><h3>README</h3>
		Load a text file of the vocabulary you want to learn. <br><br><strong style="font-size: 30px;">Format</strong><br> If your list in English-French, one column would
		be English vocab, and the other would be French. You can separate columns with a tab or multiple spaces.
		<br>
		Once the file is loaded, press start, and begin quizzing. Everything other function is fairly self-explanatory.
		<br>
		If there are any issues, please write to egmeade@live.com and let me know.
	</div>
</body>
</html>